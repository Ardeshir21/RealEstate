{% extends "FAbaseApp/base.html" %}
{% load static %}
{% load humanize %}

{% block head_description %}
  <!-- Specific Description for each page -->
  <meta name="description" content="Trendyol">
{% endblock head_description %}

{% block head_title %}
<!-- Title  -->
<title>خرید از ترندیول | Trendyol</title>
{% endblock head_title %}

<!-- The main content of the page -->
{% block body_content %}

    <div id='ajax_container'>
      <div class='ajax_loader'>
        <div class='ajax_loader--dot'></div>
        <div class='ajax_loader--dot'></div>
        <div class='ajax_loader--dot'></div>
        <div class='ajax_loader--dot'></div>
        <div class='ajax_loader--dot'></div>
        <div class='ajax_loader--dot'></div>
        <div class='ajax_loader--text'></div>
      </div>
    </div>

    <!-- ##### WideImage Area Start ##### -->
    {% include "FAbaseApp/includes/wideImage.html" %}

    <section id="LinkFrom" class="south-contact-area section-padding-50">
        <div class="container">
            <div class="row">
                <div class="col-12">
                  <div class="contact-form text-center">
                    <form id="url-form" class='form-group' method="POST">
                      <input id='requested_url' class='form-control' style="text-align: center;" type="text" placeholder="لینک محصول مورد نظر" value="">
                      <button id="submit-form" class='btn south-btn wow fadeInUp' data-wow-duration="1s" data-wow-delay="300ms" url="{% url "scrapeApp:link_scraper" %}" type="submit">محاسبه قیمت</button>
                    </form>
                  </div>
                </div>
            </div>
        </div>
    </section>

    <section id="Quotation" class="south-contact-area section-padding-50">
        <div id='result-part' class="container">
          <!-- The content of this div is loaded via AJAX from scrape_result.html -->
        </div>
    </section>






    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

    <script type="text/javascript">
      var EPPZScrollTo =
      {
          /**
           * Helpers.
           */
          documentVerticalScrollPosition: function()
          {
              if (self.pageYOffset) return self.pageYOffset; // Firefox, Chrome, Opera, Safari.
              if (document.documentElement && document.documentElement.scrollTop) return document.documentElement.scrollTop; // Internet Explorer 6 (standards mode).
              if (document.body.scrollTop) return document.body.scrollTop; // Internet Explorer 6, 7 and 8.
              return 0; // None of the above.
          },

          viewportHeight: function()
          { return (document.compatMode === "CSS1Compat") ? document.documentElement.clientHeight : document.body.clientHeight; },

          documentHeight: function()
          { return (document.height !== undefined) ? document.height : document.body.offsetHeight; },

          documentMaximumScrollPosition: function()
          { return this.documentHeight() - this.viewportHeight(); },

          elementVerticalClientPositionById: function(id)
          {
              var element = document.getElementById(id);
              var rectangle = element.getBoundingClientRect();
              return rectangle.top;
          },

          /**
           * Animation tick.
           */
          scrollVerticalTickToPosition: function(currentPosition, targetPosition)
          {
              var filter = 0.2;
              var fps = 40;
              var difference = parseFloat(targetPosition) - parseFloat(currentPosition);

              // Snap, then stop if arrived.
              var arrived = (Math.abs(difference) <= 0.5);
              if (arrived)
              {
                  // Apply target.
                  scrollTo(0.0, targetPosition);
                  return;
              }

              // Filtered position.
              currentPosition = (parseFloat(currentPosition) * (1.0 - filter)) + (parseFloat(targetPosition) * filter);

              // Apply target.
              scrollTo(0.0, Math.round(currentPosition));

              // Schedule next tick.
              setTimeout("EPPZScrollTo.scrollVerticalTickToPosition("+currentPosition+", "+targetPosition+")", (1000 / fps));
          },

          /**
           * For public use.
           *
           * @param id The id of the element to scroll to.
           * @param padding Top padding to apply above element.
           */
          scrollVerticalToElementById: function(id, padding)
          {
              var element = document.getElementById(id);
              if (element == null)
              {
                  console.warn('Cannot find element with id \''+id+'\'.');
                  return;
              }

              var targetPosition = this.documentVerticalScrollPosition() + this.elementVerticalClientPositionById(id) - padding;
              var currentPosition = this.documentVerticalScrollPosition();

              // Clamp.
              var maximumScrollPosition = this.documentMaximumScrollPosition();
              if (targetPosition > maximumScrollPosition) targetPosition = maximumScrollPosition;

              // Start animation.
              this.scrollVerticalTickToPosition(currentPosition, targetPosition);
          }
      };

    </script>

    <script type="text/javascript">
        $('#ajax_container').hide();

        $('#url-form').on('submit', function(e){
          var requested_url= $('#requested_url').val();
          var ajax_call= $('#submit-form').attr('url');
          e.preventDefault();

          $.ajax({
              type:"GET",
              url: ajax_call,
              data: {
                'requested_url': requested_url,
                'csrfmiddlewaretoken': '{{ csrf_token }}',
              },
              beforeSend: function() {
                 $('#ajax_container').show();
              },
              success: function(data){
                // console.log(data)
                $('#ajax_container').hide();
                $('#result-part').html(data);
                EPPZScrollTo.scrollVerticalToElementById('Quotation', 45);
                }
           });
        });
    </script>
{% endblock body_content %}
